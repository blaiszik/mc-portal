<!DOCTYPE html>
<html>
<head>
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/@mdi/font@4.x/css/materialdesignicons.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    
    <script src="https://cdn.jsdelivr.net/npm/vue@2.x/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.js"></script>
    <script src="https://unpkg.com/marked@0.7.0"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.15/lodash.min.js"></script>
    <script src="https://unpkg.com/vue-router"></script>

    

    <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.15.10/build/styles/default.min.css">
    <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.15.10/build/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
     <title>MDF - Add Data</title>


    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">
</head>
<body>
{%include 'header.jinja2'%}
{% raw %}
<div id="app">
    <v-container>
        <v-app id="inspire">
                <v-toolbar color="" :dark=false>
                    <v-toolbar-title></v-toolbar-title>
                    <v-spacer></v-spacer>
                    <v-btn class="ma-2" href="https://petreldata.net/mdf/?q=*&filter-match-any.mdf.resource_type=dataset" target="_blank"> Browse Datasets </v-btn>
                    <v-btn class="ma-2" href="/submissions"> My Submissions </v-btn>
                    <v-btn class="ma-2" href="/curate"> My Tasks </v-btn>
                </v-toolbar>
            <v-content>
           
                <v-layout left-justify>
                    <v-flex xs20 sm12>
                        <v-toolbar color="primary" dark>
                            <v-toolbar-title>Describe Your Dataset</v-toolbar-title>
                        </v-toolbar>
                        <v-container fluid fill-width>
                            <v-form ref="form" v-model="state.valid" lazy-validation>
                            <v-expansion-panels>
                            <v-expansion-panel >
                            <v-expansion-panel-header>
                            Quick Fill via Digitial Object Identifier (DOI)
                            </v-expansion-panel-header>
                            <v-expansion-panel-content>
                            <!-- DOI Fill -->
                                <v-card tile class="mb-2">
                                    <v-card-text>
                                        <p> Use an existing DOI to pre-populate some fields </p>
                                         <v-text-field v-model="state.doi" label="DOI" required>
                                    </v-text-field>
                                    <v-btn small color="primary" @click="fetch_doi">Go</v-btn>
                                    </v-card-text>
                                </v-card>
                            </v-expansion-panel-content>
                        </v-expansion-panel>
                        </v-expansion-panels>

<v-divider></v-divider>

                                

                                <v-toolbar color="green lighten-2" dark flat>
                                    <v-toolbar-title>Required Steps</v-toolbar-title>
                                </v-toolbar>
                                <!-- -->

                                <!-- Title Elements -->
                                <v-card elevation=0 class="mb-2">
                                    <v-card-title>Set Title</v-card-title>
                                    <v-card-text>
                                         <v-text-field v-model="form.dc.title" :rules="rules.title" label="Title" required>
                                </v-text-field>
                                    </v-card-text>
                               
                                </v-card>
                                <!-- END Title Elements -->

                                <v-divider></v-divider>

                                <!-- Author Elements -->
                                <v-card elevation=0 class="mb-2">
                                    <v-card-title>Add authors</v-card-title>
                                <v-card-text>
                                    Accepts author names of the form of Einstein, Albert or Marie S. Curie. Press 'Enter/Return' or ';'' to create a new entry.
                                <v-combobox v-model="form.dc.authors" :delimiters="[';']" :rules="rules.combo" label="Authors" chips clearable solo multiple>
                                    <template v-slot:selection="data">
                                        <v-chip outlined color="primary" :input_value="data.selected" close
                                            @click:close="remove_item(data.item, 'form.dc.authors')">
                                            <strong>{{ data.item }}</strong>&nbsp;
                                        </v-chip>
                                    </template>
                                </v-combobox>
                            </v-card-text></v-card>
                            
                            <!-- END Author Elements -->

                                 <v-divider></v-divider>

                                <!-- Affiliation Elements -->
                                <v-card elevation=0 class="mb-2">
                                    <v-card-title> Add affiliations</v-card-title>
                                    <v-card-text>
                                        Press 'Enter/Return', ',', or ';'' to create a new entry or select from the pre-filled options.
                                <v-combobox v-model="form.dc.affiliations" :delimiters="[';',',']" :rules="rules.combo" :items="options.affiliations"
                                    label="Affiliations" required chips clearable solo multiple>
                                    <template v-slot:selection="data">
                                        <v-chip outlined color="primary" :input_value="data.selected" close
                                            @click:close="remove_item(data.item, 'form.dc.affiliations')">
                                            <strong>{{ data.item }}</strong>&nbsp;
                                        </v-chip>
                                    </template>
                                </v-combobox>
                                    </v-card-text>
                                </v-card>
                                
                                <!-- END Affiliation Elements -->
                            <v-divider></v-divider>

                            <v-card elevation=0 class="mb-2">
                                    <v-card-title> Add data locations</v-card-title>
                                    <v-card-text>
                                                                <v-tabs vertical>
                                        <v-tab>
                                        Globus
                                        </v-tab>
                                        <v-tab>
                                        HTTPS
                                        </v-tab>
                                        <v-tab>
                                        Google Drive
                                        </v-tab>
                                
                                        <v-tab-item>
                                        <v-card flat>
                                            <v-card-text>
                                                    <h5> Instructions to Publish via Globus </h5>
                                                    <ol>
                                                        <li>
                                                            No additional permissions are required to share data from Globus endpoints
                                                        </li>
                                                        <li>
                                                            Copy the link to your data with the `Get Link` button in the Globus web app
                                                        </li>
                                                        <li>
                                                            Add this link as a data location
                                                        </li>
                                                    </ol>
                                                    <v-btn outlined color="primary" href="https://app.globus.org/file-manager" target="_blank">
                                                                    Find data  with Globus
                                                    </v-btn>
                                            </v-card-text>
                                        </v-card>
                                        </v-tab-item>
                                        <v-tab-item>
                                        <v-card flat>
                                            <v-card-text>
                                                <h5> Instructions to Publish via HTTPS </h5>
                                                <ol>
                                                <li>Specify a public archive of the dataset. e.g., http://host.com/file.zip as a data location</li>
                                                </ol>
                                            </v-card-text>
                                        </v-card>
                                        </v-tab-item>
                                        <v-tab-item>
                                        <v-card flat>
                                            <v-card-text>
                                            <h5> Instructions to Publish via Google Drive </h5>
                                                <ol>
                                                    <li>
                                                    Share the data path (read access) with materialsdatafacility@gmail.com
                                                    </li>
                                                    <li>
                                                    <p> Add google:///my_path as a data location (note triple `/`). </p>
                                                    <p> <b>Example:</b> A user shares the folder "abc" from their "My Drive" folder. </p>
                                                    <p> The data location below would be google:///abc </p>
                                                    </li>
                                                </ol>
                                                <v-btn outlined color="primary" href="https://drive.google.com" target="_blank">
                                                                    Find data with Google Drive
                                                                </v-btn>
                                            </v-card-text>
                                        </v-card>
                                        </v-tab-item>
                                    </v-tabs>
                                    
    
                                <v-combobox v-model="form.data" :rules="rules.combo" :delimiters="[';',',']" label="Data locations" chips clearable solo multiple>
                                    <template v-slot:selection="data">
                                        <v-chip outlined color="primary" :input_value="data.selected" close
                                            @click:close="remove_item(data.item, 'form.data')">
                                            <strong>{{ data.item }}</strong>&nbsp;
                                        </v-chip>
                                    </template>
                                </v-combobox>
                                </v-card-text>
                            </v-card>
                                <!-- END Data Elements -->

                                <v-divider></v-divider>

                                <!-- Contact  Elements -->
                                <v-card elevation=0 class="mb-2">
                                    <v-card-title> Add dataset contacts</v-card-title>
                                    <v-card-text>
                                Press 'Enter/Return', ',' or ';' to create a new entry.
                                <v-combobox v-model="form.contacts" :rules="rules.combo" :delimiters="[';',',']" label="Contact information" chips clearable solo multiple>
                                    <template v-slot:selection="data">
                                        <v-chip outlined color="primary" :input_value="data.selected" close
                                            @click:close="remove_item(data.item, 'form.contacts')">
                                            <strong>{{ data.item }}</strong>&nbsp;
                                        </v-chip>
                                    </template>
                                </v-combobox>
                            </v-card-text>
                            </v-card>
                                <!-- END Contact Elements -->

                                <v-divider></v-divider>

                                <v-toolbar color="green lighten-2" dark flat>
                                    <v-toolbar-title>Optional Steps</v-toolbar-title>
                                </v-toolbar>
                                <!-- Tag Elements -->
                                <v-card elevation=0 class="mb-2">
                                    <v-card-title>Add tags</v-card-title>
                                    <v-card-text>
                                Press 'Enter/Return', ',' or ';' to create a new entry or select from the pre-filled options.
                                <v-combobox v-model="form.dc.subjects" :delimiters="[',',';']" label="Tags" chips :items="options.subjects"
                                    clearable solo multiple>
                                    <template v-slot:selection="data">
                                        <v-chip outlined label color="primary" :input_value="data.selected" close
                                             @click:close="remove_item(data.item, 'form.dc.subjects')">
                                            <strong>{{ data.item }}</strong>&nbsp;
                                        </v-chip>
                                    </template>
                                </v-combobox>
                            </v-card-text>
                            </v-card>
                                <!-- END Tag Elements -->

                                <v-divider></v-divider>

                                <!-- Related Work Elements -->
                                <v-card elevation=0 class="mb-2">
                                    <v-card-title>Add links to related works</v-card-title>
                                    <v-card-text>
                                    Add DOIs associated with journal publications, other related datasets, etc. Entries should be DOIs.
                                Press 'Enter/Return', ',' or ';' to create a new entry or select from the pre-filled options.
                                <v-combobox v-model="form.dc.related_dois" :delimiters="[',',';']" label="DOIs" chips
                                    clearable solo multiple>
                                    <template v-slot:selection="data">
                                        <v-chip outlined label color="primary" :input_value="data.selected" close
                                             @click:close="remove_item(data.item, 'form.dc.related_dois')">
                                            <strong>{{ data.item }}</strong>&nbsp;
                                        </v-chip>
                                    </template>
                                </v-combobox>
                            </v-card-text>
                            </v-card>
                                <!-- END Related Work Elements -->
                                <v-divider></v-divider>

                                <!-- Description Elements -->
                                <v-card elevation=0 class="mb-2">
                                    <v-card-title> Set Description </v-card-title>
                                    <v-card-text>
                                <v-textarea name="input-7-1" v-model="form.dc.description" filled
                                    label="Dataset description (accepts markdown)" auto-grow value=""
                                    @blur="update_markdown(form.dc.description)">
                                </v-textarea>
                            </v-card-text>
                        </v-card>
                                <!-- END Description Elements -->

                                <v-divider></v-divider>

                                <!-- Organization Elements -->
                                <v-card elevation=0 class="mb-2">
                                    <v-card-title> Add Organization </v-card-title>
                                    
                                    <v-card-text>
                                Organizations act as a template for how your dataset with be handled. For sharing open data, MDF Open is the default
                                 <v-select v-model="form.organizations" :items="options.organizations"
                                attach
                                chips
                                label="Organizations"
                                multiple
                                ></v-select>
                            </v-card-text>
                        </v-card>
                                <!-- END Organization Elements -->

                                <v-divider></v-divider>

                                 <!-- Source Name Elements -->
                                <v-card elevation=0 class="mb-2">
                                    <v-card-title> Set Source Name </v-card-title>
                                    <v-card-text>
                                Source name is a unique identifier associated with your dataset. e.g., patel_my_dataset
                                <v-text-field v-model="form.source_name" label="Source Name" required>
                                </v-text-field>
                            </v-card-text></v-card>
                                <!-- END Source Name Elements -->
                </v-layout>
            </v-form>

            <!-- Warning Elements -->
                <v-layout left-justify>
                    <v-flex xs20 sm12>
                        <v-toolbar color="primary" dark>
                            <v-toolbar-title>Preview</v-toolbar-title>
                            <v-spacer></v-spacer>
                        </v-toolbar>
                   
                        
                        <v-card class="pt-2">
                              <v-alert
                icon="mdi-check-bold"
                prominent
                text
                type="info">
                    Before proceeding, please be sure you have followed all of your institutional data release processes.
            </v-alert>
                          <v-alert
                            v-if="form.test"
                            :value="true"
                            type="info"
                            dense
                            outlined
                            >
                            This is a test submission.
                            </v-alert>
                            <v-alert
                            v-if="form.passthrough"
                            :value="true"
                            type="info"
                            dense
                            outlined
                            >
                        Data extraction will be skipped.
                        </v-alert>
                            <v-card-title primary-title>
                                    <h2 class="headline mb-0">{{form.dc.title}}</h2>
                            </v-card-title>

                             <v-card-text>
                             <i>{{ form.dc.authors.join('; ') }}</i>
                                    <ol>
                                    <li v-for="aff in form.dc.affiliations">
                                        {{ aff }}
                                        </li>
                                    </ol>
                                    <v-sheet v-if="form.dc.description"
                                        class="pa-3"
                                        color="grey lighten-4"
                                        elevation=2
                                    >
                                    <div v-html="state.markdown"></div>
                                    </v-sheet>

                                    <v-chip class="ma-1" outlined label color="primary" v-for="tag in form.dc.subjects">
                                        {{tag}}
                                    </v-chip>
                            
                            <v-alert
                            v-if="!state.valid"
                            type="error"
                            dense
                            outlined
                            >
                            The submission is missing required inputs.
                            </v-alert>
                                   
                             </v-card-text>

                            <v-card-actions>
                                <v-btn color="primary" @click="submit_dataset" v-bind:disabled="state.spinner">Submit</v-btn>
                                <v-progress-circular
                                    indeterminate
                                    color="primary"
                                    v-if="state.spinner"
                                ></v-progress-circular>
                                   
                            </v-card-actions>
                        </v-card>
                      
                    <div v-if="state.response">
                            <v-layout left-justify>
                                <v-flex xs20 sm12>
                                    <v-toolbar color="primary" dark>
                                        <v-toolbar-title>Track Status</v-toolbar-title>
                                        <v-spacer></v-spacer>
                                    </v-toolbar>
                                <v-alert
                                v-if="!state.submit_success && state.response"
                                :value="true"
                                border="left"
                                colored-border
                                type="error"
                                elevation="2"
                                >
                                <div> If you haven't already, please <a class="btn btn-lg btn-outline-dark mr-2" 
                                href="https://app.globus.org/groups/cc192dca-3751-11e8-90c1-0a7c735d220a/about" target="_blank">
                                        Join this Group</a> and re-submit.</div>

                                <div> Submission failed, please contact the MDF team (blaiszik@uchicago.edu) with the information below. </div>
                                <div>{{state.response.status}} - {{state.response.statusText}}</div>
                                <div> {{state.response.data.error}} </div>
                              </v-alert>

                              <v-alert
                                v-if="state.submit_success"
                                :value="true"
                                color="success"
                                outlined
                              >
                            <h1> Success! </h1>
                             <v-btn color="success" :href="/status/+state.response.data.source_id" target="_blank">
                               Track the status of your submission
                            </v-btn>
                              </v-alert>
                                </v-flex>
                            </v-layout>
                    </div>
                    
                    <!-- Dataset Options Elements -->
                     <v-toolbar color="primary" dark>
                            <v-toolbar-title>Dataset Options</v-toolbar-title>
                            <v-spacer></v-spacer>
                        </v-toolbar>

                        <v-card tile class="mb-2">
                                    <v-card-title mb-0>
                                       <v-checkbox v-model="form.update" v-on="on" label="Submit a Dataset Revision"
                        :value=false></v-checkbox></v-card-title>
                                    <v-card-subtitle>
                                    To submit a dataset revision, check this box, and ensure your source name matches your previous submission. 
                                    This is only necessary if you have submitted the same dataset previously and would like to create a new version.
                                    </v-card-subtitle>
                        </v-card>

                        <v-card tile class="mb-2">
                                    <v-card-title>
                                      <v-checkbox v-model="form.test" label="Submit Dataset as a Test Submission"
                        :value=false></v-checkbox> </v-card-title>
                                    <v-card-subtitle>
                                    To submit a this dataset as a test submission, check this box. 
                                    Test submissions enable testing of dataset extractions and more without creating permanent datasets or identifiers (e.g., DOIs). 
                                    </v-card-subtitle>
                        </v-card>

                        <v-card tile class="mb-2">
                                    <v-card-title>
                                        <v-checkbox v-model="form.passthrough" label="Skip Data Extraction"
                                :value=false></v-checkbox></v-card-title>
                                    <v-card-subtitle>
                                    If your data are larger than 50 GB, please check this box.
                                    </v-card-subtitle>
                        </v-card>

                         <v-card tile class="mb-2">
                                    <v-card-title>
                                        <v-checkbox v-model="state.debug" label="Debug Mode"
                        :value=false></v-checkbox></v-card-title>
                                    <v-card-subtitle>
                                    To enable Debug mode, check this box.
                                    </v-card-subtitle>
                        </v-card>

                        
                        
                    <!-- END Dataset Options Elements -->

                    

                    <!-- Debug Elements -->
                    <div id="debug" v-if="state.debug">
                    <v-toolbar color="primary" dark>
                            <v-toolbar-title>Debug</v-toolbar-title>
                    </v-toolbar>
                    <h1> Current Form Info </h1>
                    <v-btn color="primary" @click="fill_dummy_data">Fill Dummy Data</v-btn>
                            <pre><code class="json"> {{form}} </code></pre>
                    <h1> Fill Form with JSON (not recommended!) </h1>
                    <v-textarea name="input-7-2" v-model="state.form_json" filled
                                    auto-grow value=""
                                    @blur="fill_form_data(state.form_json)">
                                </v-textarea>

                    
                    </div>

                    </div>



                    <!-- END Debug Elements -->


                    </v-flex>
                </v-layout>
                <v-container>

        </v-app>
    </div>
    </v-content>
    </v-container>

<script src="./static/js/dataset_form.js"></script>

{% endraw %}

</body>

</html>